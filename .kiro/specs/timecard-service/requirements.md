# 要件定義書

## 概要

タイムカードサービスは、従業員が出勤・退勤の打刻を行い、勤怠管理を効率化するための Web アプリケーションです。管理者は従業員の勤怠状況を確認し、勤務時間の集計や管理を行うことができます。

## 要件

### 要件 1

**ユーザーストーリー:** 従業員として、社員通用口の端末で簡単に出勤打刻を行いたい。これにより、正確な出勤時刻を記録できる。

#### 受入基準

1. WHEN 従業員が NFC 対応デバイスを端末にかざす THEN システムは従業員を識別し現在時刻を出勤時刻として記録する
2. WHEN 従業員が QR コードをスマホで読み取る THEN システムは従業員認証画面を表示し、認証後に出勤時刻を記録する
3. WHEN 従業員が社員 ID と PIN コードを手動入力 THEN システムは認証後に出勤時刻を記録する
4. WHEN 出勤打刻が完了 THEN 端末は「出勤打刻完了」メッセージを表示する
5. IF 既に出勤打刻済みの場合 THEN システムは「既に出勤済みです」エラーメッセージを表示する
6. IF 認証に失敗した場合 THEN システムは「認証に失敗しました」エラーメッセージを表示する

### 要件 2

**ユーザーストーリー:** 従業員として、社員通用口の端末で簡単に退勤打刻を行いたい。これにより、正確な退勤時刻を記録し、勤務時間を確定できる。

#### 受入基準

1. WHEN 従業員が NFC 対応デバイスを端末にかざす THEN システムは従業員を識別し現在時刻を退勤時刻として記録する
2. WHEN 従業員が QR コードをスマホで読み取る THEN システムは従業員認証画面を表示し、認証後に退勤時刻を記録する
3. WHEN 従業員が社員 ID と PIN コードを手動入力 THEN システムは認証後に退勤時刻を記録する
4. WHEN 退勤打刻が完了 THEN 端末は勤務時間を自動計算し表示する
5. IF 出勤打刻がない場合 THEN システムは「出勤打刻を先に行ってください」エラーメッセージを表示する
6. IF 認証に失敗した場合 THEN システムは「認証に失敗しました」エラーメッセージを表示する

### 要件 3

**ユーザーストーリー:** 従業員として、自分の勤怠履歴を確認したい。これにより、過去の勤務状況を把握できる。

#### 受入基準

1. WHEN 従業員がマイページにアクセス THEN システムは過去 30 日分の勤怠履歴を表示する
2. WHEN 勤怠履歴を表示 THEN システムは日付、出勤時刻、退勤時刻、勤務時間を含む
3. WHEN 月を選択 THEN システムは指定月の勤怠履歴を表示する

### 要件 4

**ユーザーストーリー:** 管理者として、全従業員の勤怠状況を確認したい。これにより、チーム全体の勤務状況を把握し管理できる。

#### 受入基準

1. WHEN 管理者が管理画面にアクセス THEN システムは全従業員の当日の勤怠状況を表示する
2. WHEN 従業員を選択 THEN システムはその従業員の詳細な勤怠履歴を表示する
3. WHEN 期間を指定 THEN システムは指定期間の勤怠データを表示する

### 要件 5

**ユーザーストーリー:** 管理者として、勤怠データをエクスポートしたい。これにより、給与計算や人事管理に活用できる。

#### 受入基準

1. WHEN 管理者がエクスポート機能を使用 THEN システムは CSV 形式で勤怠データを出力する
2. WHEN エクスポート対象期間を指定 THEN システムは指定期間のデータのみを出力する
3. WHEN エクスポートが完了 THEN システムはダウンロードリンクを提供する

### 要件 6

**ユーザーストーリー:** 管理者として、打刻端末を設定・管理したい。これにより、端末の状態を監視し、適切に運用できる。

#### 受入基準

1. WHEN 管理者が端末管理画面にアクセス THEN システムは登録済み端末の一覧と状態を表示する
2. WHEN 新しい端末を登録 THEN システムは端末 ID と設置場所を記録する
3. WHEN 端末がオフライン THEN システムは管理者にアラートを送信する
4. WHEN 端末の設定を変更 THEN システムは変更内容を端末に反映する

### 要件 7

**ユーザーストーリー:** システムとして、端末とサーバー間で安全に通信したい。これにより、打刻データの整合性を保証できる。

#### 受入基準

1. WHEN 端末が打刻データを送信 THEN システムは暗号化された通信で受信する
2. WHEN ネットワーク接続が不安定 THEN 端末は打刻データをローカルに保存し、接続回復時に同期する
3. WHEN データ同期が完了 THEN システムは端末に確認応答を送信する
4. IF データの整合性チェックに失敗 THEN システムは管理者にエラー通知を送信する

### 要件 8

**ユーザーストーリー:** 管理者として、従業員の NFC デバイスを登録・管理したい。これにより、従業員が打刻端末で NFC 打刻を利用できるようになる。

#### 受入基準

1. WHEN 管理者が Web 画面で従業員情報を登録 THEN システムは従業員データを作成し NFC 未登録状態とする
2. WHEN 管理者が打刻端末にログイン THEN システムは管理者モードを有効化する
3. WHEN 管理者モードで従業員を選択し NFC デバイスを打刻端末に接触 THEN システムは NFC ID を従業員に紐付けて登録する
4. WHEN NFC 登録が完了 THEN システムは「NFC 登録完了」メッセージを表示する
5. WHEN 管理者が NFC 変更モードで従業員を選択し新しい NFC デバイスを接触 THEN システムは古い NFC ID を無効化し新しい ID を登録する
6. IF 既に他の従業員に登録済みの NFC ID を登録しようとした場合 THEN システムは「この NFC は既に登録済みです」エラーメッセージを表示する

### 要件 9

**ユーザーストーリー:** ユーザーとして、安全にログインしたい。これにより、個人の勤怠情報を保護できる。

#### 受入基準

1. WHEN ユーザーが正しい認証情報を入力 THEN システムはログインを許可する
2. WHEN ログインに失敗 THEN システムは適切なエラーメッセージを表示する
3. IF 一定回数ログインに失敗 THEN システムはアカウントを一時的にロックする
